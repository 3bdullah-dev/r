<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CryptoCoinNews</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="website icon" type="png" href="data/logo.png" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/@contentful/rich-text-html-renderer/15.3.0/rich-text-html-renderer.min.js"></script>

  </head>
  <body>
    <nav class="top-nav">
      <div class="container">
        <button class="menu-toggle" id="menuToggle">☰</button>

        <!-- <img src="data/logo.png" alt="Logo" class="top-logo" /> -->
        <div class="top-links" id="top-links">
          <!-- <a href="#">Home</a> -->
          <a href="#news" class="nav-link">News</a>
          <a href="#articles" class="nav-link">Articles</a>
          <a href="#about" class="nav-link">About Us</a>
          <a href="#privacy-policy" class="nav-link">Privacy Policy</a>
          <a href="#contact" class="nav-link">Contact Us</a>
        </div>
        <button class="theme-toggle" id="themeToggle">🌓</button>
      </div>
    </nav>

    

    <nav class="main-nav">
      <div class="container">
        <div class="logo">
          <a
            href="admin.html"
            target="_blank"
            class="web-title"
            >CryptoCoinNews</a
          >
        </div>

      </div>
    </nav>

    <div class="ticker-container">
      <div class="ticker" id="ticker">
        <!-- Cryptocurrency prices will be inserted here -->
      </div>
    </div>

    <section id="news">
      <div class="latest-bitcoin-news" id="latestBitcoinNews">
        <h2 class="section-title">Lastest News</h2>
        <div class="news-container" id="newsContainer">
          <!-- الأخبار سيتم إضافتها هنا ديناميكيًا -->
        </div>
      </div>
    </section>

   
    <h2 class="section-title" style="  font-size: 3rem;
    color: var(--primary-color);
    margin-bottom: 1.5rem;
    margin-left: 0.3rem;
    text-align: center;">Articles</h2> 
    <section id="articles">
    <div class="articles-container">
      
      <div id="articles"></div>
  </div>
    </section>

    <section id="about">
      <div class="container">
        <h2 class="section-title">ِAbout Us</h2>
        <p class="about-content">
          Welcome to CryptoCoinNews, a leading platform in [your field]. We
          specialize in [the services you offer] with a focus on quality and
          innovation. Our Mission Our mission is to be the go-to choice for our
          customers by delivering innovative solutions. Our Team We are a team
          of professionals in [your field], working together to provide the best
          services. Our History CryptoCoinNews was founded in 3 years, and since
          then, we have been continuously improving our services. Contact Us For
          inquiries, please contact us
        </p>
      </div>
    </section>

    <section id="privacy-policy">
      <div class="container">
        <h2 class="section-title">Privacy Policy</h2>
        <p class="privacy-content">
          Welcome to CryptoCoinNews. We are committed to protecting your privacy
          and personal data. This policy explains how we collect, use, and
          protect your information. Data We Collect We may collect information
          such as your name, email address, and browsing data. How We Collect
          Data We use cookies and online forms to collect your data. Purpose of
          Data Collection We use your data to improve our services and respond
          to your inquiries. Data Protection We use advanced encryption
          technologies to protect your data. User Rights You can request to
          access, correct, or delete your data at any time. Policy Changes We
          may update this policy from time to time. Contact Us For questions
          about this policy
        </p>
      </div>
    </section>

    <section id="contact">
      <div class="container">
        <h2 class="section-title">Contact Us</h2>
        <form id="contact-form" method="POST" action="https://formspree.io/f/mvgzjyno">
          <div class="form-group">
            <label for="name">Name</label>
            <input
              type="text"
              id="name"
              name="name"
              placeholder="Enter your name"
              required
            />
          </div>
          <div class="form-group">
            <label for="email">Email</label>
            <input
              type="email"
              id="email"
              name="email"
              placeholder="Enter your email"
              required
            />
          </div>
          <div class="form-group">
            <label for="message">Message</label>
            <textarea
              id="message"
              name="message"
              rows="5"
              placeholder="Enter your message"
              required
            ></textarea>
          </div>
          <!-- <button type="submit" class="submit-btn">Send</button> -->
          <input type="submit" class="submit-btn" value="Send">
        </form>
      </div>
    </section>

    <footer class="footer">
      <div class="container">
        <!-- الجملة الشهيرة
        <p class="footer-quote">
          "Empowering your journey through the digital age."
        </p> -->

        <!-- روابط السوشيال ميديا -->
        <div class="social-links">
          <a
            href="https://www.youtube.com/@ramaalbrin"
            target="_blank"
            class="social-icon"
            aria-label="YouTube"
          >
            <img
              src="https://static.vecteezy.com/system/resources/previews/018/930/572/non_2x/youtube-logo-youtube-icon-transparent-free-png.png"
              alt="YouTube"
              style="width: 120px; height: 120px; position: relative; top: -14px;"
            />
          </a>
          <a
            href="https://www.pinterest.com/Cryptotrendsnews/?actingBusinessId=659003495382314826"
            target="_blank"
            class="social-icon"
            aria-label="Pinterest"
          >
            <img
              src="https://static.vecteezy.com/system/resources/previews/016/716/461/original/pinterest-icon-free-png.png"
              alt="Pinterest"
              style="width: 60px; height: 60px; position: relative; top: 15px;"
            />
          </a>
        </div>

          <span id="userCountry"></span>
        </p>
        <a style="display: none;" href="admin.html">صفحة الإدارة</a>

        <script>
      let visitStartTime = Date.now();
let userLocation = "غير معروف";
const GOOGLE_SHEET_URL =
  "https://script.google.com/macros/s/AKfycbzTFdRoFIOmxtuAERwjFDFtUJLPPrf53Y3mRHJlCQw4en6dk4LI27Knjbw-ZAdZarY3oA/exec";

let lastSentTimestamp = null; // متغير لتجنب إرسال بيانات متكررة

// 🟢 الحصول على موقع المستخدم (الدولة + المدينة)
async function getUserLocation() {
  if (userLocation !== "غير معروف") return; // إذا كانت البيانات موجودة، لا تقم بجلبها مرة أخرى

  try {
    const response = await fetch("https://ipinfo.io/json");
    const data = await response.json();
    
    // جلب اسم الدولة بالكامل
    const countryResponse = await fetch(`https://restcountries.com/v3.1/alpha/${data.country}`);
    const countryData = await countryResponse.json();
    
    let countryName = countryData[0]?.name?.common || "غير معروف";
    let city = data.city || "غير معروف";

    userLocation = `${countryName}, ${city}`; // تخزين الدولة + المدينة معًا
    console.log("تم تحديد الموقع:", userLocation);
  } catch (error) {
    console.error("❌ خطأ في جلب الموقع:", error);
  }
}

// 🟢 وظيفة تسجيل البيانات
async function sendVisitData() {
  await getUserLocation(); // تأكد من أن بيانات الموقع محملة

  const visitEndTime = Date.now();
  const visitDuration = visitEndTime - visitStartTime;

  if (visitDuration > 5000 && userLocation != "غير معروف") {
    const data = {
      country: userLocation, // إرسال (الدولة + المدينة)
      timestamp: new Date(visitEndTime).toISOString(),
      timeSpent: visitDuration,
    };

    // ✅ منع إرسال بيانات مكررة إذا كان الوقت متشابهًا جدًا مع آخر إرسال
    if (lastSentTimestamp && Math.abs(visitEndTime - lastSentTimestamp) < 100) {
      console.log("🚫 تم منع إرسال البيانات المكررة");
      return;
    }

    console.log("✅ إرسال البيانات:", data);
    navigator.sendBeacon(GOOGLE_SHEET_URL, JSON.stringify(data));

    lastSentTimestamp = visitEndTime; // حفظ آخر وقت إرسال لمنع التكرار
  } else {
    console.log("⏳ لم يتم إرسال البيانات: مدة الزيارة قصيرة أو الموقع غير محدد.");
  }
}

// 🟢 تحميل بيانات الموقع مرة واحدة
getUserLocation().then(() => {
  window.addEventListener("visibilitychange", async () => {
    if (document.visibilityState === "hidden") {
      await sendVisitData();
    } else if (document.visibilityState === "visible") {
      visitStartTime = Date.now();
    }
  });

  window.addEventListener("pagehide", sendVisitData);
});

    
          // إعادة تعيين وقت البداية عند العودة إلى الصفحة
          function resetVisitStartTime() {
            visitStartTime = Date.now();
          }
    
          // تسجيل البيانات عند إغلاق الصفحة أو مغادرة التبويبة
          window.addEventListener("visibilitychange", () => {
            if (document.visibilityState === "hidden") {
              sendVisitData();
            } else if (document.visibilityState === "visible") {
              resetVisitStartTime();
            }
          });
    
          window.addEventListener("pagehide", sendVisitData);
    
          // إعادة تعيين وقت البداية عند التركيز على الصفحة
          window.addEventListener("focus", resetVisitStartTime);


          async function fetchArticles() {
        const spaceId = "1xctpowg2b6z";
        const accessToken = "np4JYIYcZ2zUEs1D_CDt7k6dHeBcQAEImSirUppOzHE";
        const url = `https://cdn.contentful.com/spaces/${spaceId}/environments/master/entries?access_token=${accessToken}&content_type=article`;

        try {
          const response = await fetch(url);
          const data = await response.json();
          displayArticles(data.items);
        } catch (error) {
          console.error("Error fetching articles:", error);
        }
      }


      function extractTextFromRichText(richText) {
        if (!richText || !richText.content) return ""; // تجنب الأخطاء إذا لم يكن هناك محتوى
        return richText.content
          .map((block) =>
            block.content
              ? block.content.map((text) => text.value).join(" ")
              : ""
          )
          .join("\n");
      }

      function displayArticles(articles) {
        const container = document.getElementById("articles");
        container.innerHTML = "";

        articles.forEach((article) => {
          const title = article.fields.title;
          const url = article.fields.url;

          const articleDiv = document.createElement("div");
          articleDiv.className = "article";

          const titleElement = document.createElement("h2");
          titleElement.textContent = title;

          const button = document.createElement("a");
          button.className = "toggle-article";
          button.textContent = "Read More";
          button.href = url;
          button.target = "_blank"; // فتح الرابط في نافذة جديدة
          button.style.display = "inline-block";
          button.style.marginTop = "10px";
          button.style.padding = "8px 12px";
          button.style.backgroundColor = "#007bff";
          button.style.color = "#fff";
          button.style.borderRadius = "5px";
          button.style.textDecoration = "none";


          // button.addEventListener("click", function () {
          //   if (
          //     contentElement.style.display === "none" ||
          //     contentElement.style.display === ""
          //   ) {
          //     contentElement.style.display = "block";
          //     button.textContent = "Read Less";
          //   } else {
          //     contentElement.style.display = "none";
          //     button.textContent = "Read More";
          //   }
          // });

          articleDiv.appendChild(titleElement);
          articleDiv.appendChild(button);
          container.appendChild(articleDiv);
        });
      }

      fetchArticles();
        </script>
        <!-- حقوق الملكية -->
        <p class="footer-copyright" style="font-size: 18px;">
          Developed by <a
          href="https://khamsat.com/user/abdalllah_dev"
          target="_blank"
          aria-label="Pinterest"
          style="color: #0066cc; text-decoration: none; font-size: 18px;"
          
        >
          Abdullah Ahmed
        </a> <br> <br>
          &copy; 2025 CryptoCoinNews. All Rights Reserved.
        </p>
      </div>
    </footer>

    <script src="main.js"></script>
    <script>
        const menuToggle = document.getElementById('menuToggle');
        const topLinks = document.getElementById('top-links');
        const navLinks = document.querySelectorAll('.nav-link');
        
        menuToggle.addEventListener('click', function() {
            topLinks.classList.toggle('active');
        });
        
        navLinks.forEach(link => {
            link.addEventListener('click', function() {
                topLinks.classList.remove('active');
            });
        });


        
    </script>

  </body>
</html>
